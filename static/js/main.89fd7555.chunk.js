(this["webpackJsonpreact-mesto-auth"]=this["webpackJsonpreact-mesto-auth"]||[]).push([[0],{19:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),r=n(11),i=n.n(r),o=(n(19),n(2)),s=n(14),l=n(4),u=n(3),b=n(6),j=n(0);var d=function(e){var t=e.loggedIn,n=e.email,c=e.handleLogout,r=Object(u.f)().pathname,i=Object(a.useState)({href:"",text:""}),o=Object(l.a)(i,2),s=o[0],d=o[1];return Object(a.useEffect)((function(){d("/sign-in"===r?{href:"/sign-up",text:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}:t?{href:"/sign-in",text:"\u0412\u044b\u0439\u0442\u0438",onClick:c}:{href:"/sign-in",text:"\u0412\u043e\u0439\u0442\u0438"})}),[r,t,c]),Object(j.jsxs)("header",{className:"header",children:[Object(j.jsx)(b.b,{to:"/",className:"header__logo","aria-label":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"}),Object(j.jsx)("div",{className:"space"}),Object(j.jsx)("p",{className:"header__info",children:n}),Object(j.jsx)(b.b,{to:s.href,onClick:s.onClick,className:"header__link button",children:s.text})]})},m=c.a.createContext();var f=function(e){var t=Object(a.useContext)(m),n=e.owner._id===t._id,c=e.likes.some((function(e){return e._id===t._id}));return Object(j.jsxs)("li",{className:"place",children:[Object(j.jsx)("img",{className:"place__image",src:e.link,alt:e.name,title:"\u0414\u043e\u0431\u0430\u0432\u0438\u043b ".concat(e.owner.name),onClick:function(){e.onCardClick(e)}}),Object(j.jsx)("h2",{className:"place__caption",children:e.name}),n?Object(j.jsx)("button",{className:"place__delete button",type:"button","aria-label":"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",onClick:function(){e.onCardDelete(e)}}):"",Object(j.jsxs)("div",{className:"place__like-container",children:[Object(j.jsx)("button",{className:"place__like ".concat(c?"place__like_active":""," button"),onClick:function(){e.onCardLike(e,c)},type:"button","aria-label":"\u041d\u0440\u0430\u0432\u0438\u0442\u0441\u044f",title:"\u041d\u0440\u0430\u0432\u0438\u0442\u0441\u044f"}),Object(j.jsx)("p",{className:"place__like-counter",children:e.likes.length})]})]})};var _=function(e){var t=Object(a.useContext)(m);return Object(j.jsxs)("main",{className:"root__content",children:[Object(j.jsxs)("section",{className:"profile root__profile",children:[Object(j.jsx)("div",{className:"profile__avatar-container",onClick:e.onEditAvatar,children:Object(j.jsx)("img",{className:"profile__avatar",src:t.avatar,alt:"\u0410\u0432\u0430\u0442\u0430\u0440 \u043d\u0430\u0448\u0435\u0433\u043e \u0433\u0435\u0440\u043e\u044f"})}),Object(j.jsxs)("div",{className:"profile__info",children:[Object(j.jsx)("h1",{className:"profile__name",children:t.name}),Object(j.jsx)("button",{className:"profile__edit button",type:"button","aria-label":"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",onClick:e.onEditProfile}),Object(j.jsx)("p",{className:"profile__position",children:t.about})]}),Object(j.jsx)("button",{className:"profile__add-place button",type:"button","aria-label":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u043c\u0435\u0441\u0442\u0430",onClick:e.onAddPlace})]}),Object(j.jsx)("section",{className:"root__places",children:Object(j.jsx)("ul",{className:"places",children:e.cards.map((function(t){return Object(j.jsx)(f,Object(o.a)({onCardClick:e.onCardClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete},t),t._id)}))})})]})};var p=function(e){return Object(j.jsx)("footer",{className:"footer root__footer",children:Object(j.jsx)("p",{className:"footer__copyright",children:"\xa9 2021 \u041d\u0438\u043a\u043e\u043b\u0430\u0439 \u0428\u0438\u0440\u043e\u043a\u043e\u0432"})})};var O=function(e){function t(t){"Escape"===t.key&&e.setOpenState(!1)}return Object(a.useEffect)((function(){e.isOpen?document.addEventListener("keydown",t):document.removeEventListener("keydown",t)}),[e.isOpen]),Object(j.jsx)("div",{className:"popup ".concat(e.isOpen?"popup_opened":""),onClick:function(t){(t.target===t.currentTarget||t.target.classList.contains("popup__close"))&&e.setOpenState(!1)},children:Object(j.jsxs)("div",{className:"popup__container",children:[Object(j.jsx)("button",{className:"popup__close button",type:"button","aria-label":"\u0417\u0430\u043a\u0440\u044b\u0442\u044c"}),e.children]})})};var h=function(e){var t=Object(a.useState)(e.buttonText),n=Object(l.a)(t,2),c=n[0],r=n[1];return Object(j.jsx)(O,Object(o.a)(Object(o.a)({},e),{},{children:Object(j.jsxs)("form",{ref:e.formRef,className:"form",action:"post",name:"form-".concat(e.name),onSubmit:function(t){if(t.preventDefault(),e.onSubmit){r(e.buttonWaitingText?e.buttonWaitingText:e.buttonText);var n=e.onSubmit(t);n instanceof Promise&&(n.then((function(t){return e.setOpenState(!1)})),n.finally((function(t){return r(e.buttonText)})))}},noValidate:!0,children:[Object(j.jsx)("h2",{className:"form__title",children:e.title}),e.children,Object(j.jsx)("button",{className:"form__submit ".concat(e.isButtonDisabled?"form__submit_disabled":""," button"),type:"submit",children:c})]})}))};var x=function(e){return Object(j.jsx)(O,Object(o.a)(Object(o.a)({},e),{},{children:Object(j.jsxs)("figure",{className:"figure",children:[Object(j.jsx)("img",{className:"figure__image",src:e.card.link,alt:e.card.name}),Object(j.jsx)("figcaption",{className:"figure__caption",children:e.card.name})]})}))};function v(e){console.error(e)}var g=n(12),k=n(13),N=function(){function e(t){Object(g.a)(this,e),this._options=t}return Object(k.a)(e,[{key:"_sendQuery",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.headers=this._options.headers,fetch("".concat(this._options.baseUrl,"/").concat(e),t).then((function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))}))}},{key:"getInitialCards",value:function(){return this._sendQuery("cards")}},{key:"getUserInfo",value:function(){return this._sendQuery("users/me")}},{key:"patchUserInfo",value:function(e){var t={method:"PATCH",body:JSON.stringify({name:e.name,about:e.about})};return this._sendQuery("users/me",t)}},{key:"patchAvatar",value:function(e){var t={method:"PATCH",body:JSON.stringify({avatar:e})};return this._sendQuery("users/me/avatar",t)}},{key:"postCard",value:function(e){var t={method:"POST",body:JSON.stringify({name:e.name,link:e.link})};return this._sendQuery("cards",t)}},{key:"deleteCard",value:function(e){return this._sendQuery("cards/".concat(e),{method:"DELETE"})}},{key:"setStateLike",value:function(e,t){var n={method:t?"DELETE":"PUT"};return this._sendQuery("cards/likes/".concat(e),n)}}]),e}(),C=new N({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-28",headers:{authorization:"720b9ff8-fdb3-4425-b748-9e049f638fb6","Content-Type":"application/json"}}),y=n(8);function S(){var e=Object(a.useState)({}),t=Object(l.a)(e,2),n=t[0],c=t[1],r=Object(a.useState)({}),i=Object(l.a)(r,2),s=i[0],u=i[1],b=Object(a.useState)(!1),j=Object(l.a)(b,2),d=j[0],m=j[1],f=Object(a.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];c(e),u(t),m(n)}),[c,u,m]);return{values:n,handleChange:function(e){var t=e.target,a=t.name,r=t.value;c(Object(o.a)(Object(o.a)({},n),{},Object(y.a)({},a,r))),u(Object(o.a)(Object(o.a)({},s),{},Object(y.a)({},a,e.target.validationMessage))),m(e.target.closest("form").checkValidity())},errors:s,isValid:d,resetForm:f,setValues:c,setIsValid:m}}var T=function(e){var t=S(),n=t.values,c=t.handleChange,r=t.errors,i=t.isValid,s=t.resetForm,l=Object(a.useRef)(),u=Object(a.useContext)(m);return Object(a.useEffect)((function(){if(u.name){var e={name:u.name,about:u.about};s(e,{},l.current.checkValidity())}}),[u,e.isOpen,s]),Object(j.jsx)(h,Object(o.a)(Object(o.a)({},e),{},{title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",name:"edit-profile",formRef:l,isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(){return e.onUpdateUser({name:n.name,about:n.about})},isButtonDisabled:!i,buttonText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",buttonWaitingText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435...",children:Object(j.jsxs)("fieldset",{className:"form__fields",children:[Object(j.jsxs)("label",{className:"form__field",children:[Object(j.jsx)("input",{value:n.name||"",onChange:c,className:"form__input ".concat(r.name?"form__input_type_error":""),type:"text",name:"name",placeholder:"\u0418\u043c\u044f \u0433\u0435\u0440\u043e\u044f",required:!0,minLength:"2",maxLength:"40"}),Object(j.jsx)("span",{className:"form__input-error ".concat(r.name?"form__input-error_visible":""),children:r.name})]}),Object(j.jsxs)("label",{className:"form__field",children:[Object(j.jsx)("input",{value:n.about||"",onChange:c,className:"form__input ".concat(r.about?"form__input_type_error":""),type:"text",name:"about",placeholder:"\u041f\u043e\u0437\u0438\u0446\u0438\u044f \u0433\u0435\u0440\u043e\u044f \u0432 \u043c\u0438\u0440\u0435",required:!0,minLength:"2",maxLength:"200"}),Object(j.jsx)("span",{className:"form__input-error ".concat(r.about?"form__input-error_visible":""),children:r.about})]})]})}))};var L=function(e){var t=Object(a.useRef)();return Object(j.jsx)(h,Object(o.a)(Object(o.a)({},e),{},{title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",name:"edit-avatar",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(){var n=e.onUpdateAvatar(t.current.value);return t.current.value="",n},buttonText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",buttonWaitingText:"\u0421\u043e\u0445\u0440\u0435\u043d\u0435\u043d\u0438\u0435...",children:Object(j.jsx)("fieldset",{className:"form__fields",children:Object(j.jsxs)("label",{className:"form__field",children:[Object(j.jsx)("input",{ref:t,className:"form__input",type:"url",name:"link",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",required:!0}),Object(j.jsx)("span",{className:"form__input-error","data-input-name":"link"})]})})}))};var E=function(e){var t=S(),n=t.values,c=t.handleChange,r=t.errors,i=t.isValid,s=t.resetForm;return Object(a.useEffect)((function(){e.isOpen&&s()}),[e.isOpen,s]),Object(j.jsx)(h,Object(o.a)(Object(o.a)({},e),{},{title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",name:"add-place",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(){return e.onAddCard({name:n.name,link:n.link})},isButtonDisabled:!i,buttonText:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",buttonWaitingText:"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435...",children:Object(j.jsxs)("fieldset",{className:"form__fields",children:[Object(j.jsxs)("label",{className:"form__field",children:[Object(j.jsx)("input",{value:n.name||"",onChange:c,className:"form__input ".concat(r.name?"form__input_type_error":""),type:"text",name:"name",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",required:!0,minLength:"2",maxLength:"30"}),Object(j.jsx)("span",{className:"form__input-error ".concat(r.name?"form__input-error_visible":""),"data-input-name":"name",children:r.name})]}),Object(j.jsxs)("label",{className:"form__field",children:[Object(j.jsx)("input",{value:n.link||"",onChange:c,className:"form__input ".concat(r.link?"form__input_type_error":""),type:"url",name:"link",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",required:!0}),Object(j.jsx)("span",{className:"form__input-error ".concat(r.link?"form__input-error_visible":""),"data-input-name":"link",children:r.link})]})]})}))};var I=function(e){var t=e.loggedIn,n=e.children,a=e.redirectTo;return t?n:Object(j.jsx)(u.a,{to:a})};var P=function(e){return Object(j.jsx)(O,Object(o.a)(Object(o.a)({},e),{},{children:Object(j.jsxs)("figure",{className:"info-tooltip",children:[Object(j.jsx)("div",{className:"info-tooltip__icon ".concat(e.ok?"info-tooltip__icon_type_success":"info-tooltip__icon_type_error")}),Object(j.jsx)("figcaption",{className:"info-tooltip__text",children:e.text})]})}))};var w=function(e){var t=S(),n=t.values,c=t.handleChange,r=t.errors,i=t.isValid,s="\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437.",u=Object(a.useState)({ok:!1,text:s}),b=Object(l.a)(u,2),d=b[0],m=b[1],f=Object(a.useState)(!1),_=Object(l.a)(f,2),p=_[0],O=_[1];return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("form",{className:"form form_place_auth center",action:"post",name:"form-".concat(e.name),onSubmit:function(t){t.preventDefault(),e.handleSubmit(n).then((function(t){m({ok:!0,text:e.succesText||"\u0423\u0441\u043f\u0435\u0448\u043d\u043e!"}),O(!0)})).catch((function(e){m({ok:!1,text:e.text||s}),O(!0)}))},noValidate:!0,children:[Object(j.jsx)("h2",{className:"form__title center",children:e.title}),Object(j.jsxs)("fieldset",{className:"form__fields",children:[Object(j.jsxs)("label",{className:"form__field",children:[Object(j.jsx)("input",{value:n.email||"",onChange:c,className:"form__input form__input_place_auth ".concat(r.email?"form__input_type_error":""),type:"email",name:"email",placeholder:"Email",required:!0}),Object(j.jsx)("span",{className:"form__input-error ".concat(r.email?"form__input-error_visible":""),children:r.email})]}),Object(j.jsxs)("label",{className:"form__field",children:[Object(j.jsx)("input",{value:n.password||"",onChange:c,className:"form__input form__input_place_auth ".concat(r.password?"form__input_type_error":""),type:"password",name:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",required:!0}),Object(j.jsx)("span",{className:"form__input-error ".concat(r.password?"form__input-error_visible":""),children:r.password})]})]}),Object(j.jsx)("div",{className:"space"}),Object(j.jsx)("button",{className:"form__submit form__submit_place_auth ".concat(i?"":"form__submit_disabled"," button"),type:"submit",disabled:!i,children:e.buttonText}),e.additionalText]}),Object(j.jsx)(P,Object(o.a)({isOpen:p,setOpenState:O},d))]})};var A=function(e){return Object(j.jsx)(w,Object(o.a)(Object(o.a)({},e),{},{name:"login",title:"\u0412\u0445\u043e\u0434",buttonText:"\u0412\u0445\u043e\u0434",additionalText:Object(j.jsx)("p",{className:"form__additional-text center"})}))};var U=function(e){return Object(j.jsx)(w,Object(o.a)(Object(o.a)({},e),{},{name:"register",title:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",buttonText:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f",succesText:"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!",additionalText:Object(j.jsxs)("p",{className:"form__additional-text center",children:["\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b? ",Object(j.jsx)(b.b,{className:"form__link button",to:"/sign-in",children:"\u0412\u043e\u0439\u0442\u0438"})]})}))};function D(){var e={loggedIn:!1},t=Object(u.g)(),n=Object(a.useState)(e),c=Object(l.a)(n,2),r=c[0],i=c[1],s=function(e,t){return t.headers||(t.headers={}),t.headers["Content-Type"]="application/json",fetch("".concat("https://auth.nomoreparties.co","/").concat(e),t).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject({text:e.error?e.error:e.message})}))}))},b=function(e){return function(e){var t={method:"GET",headers:{Authorization:"Bearer ".concat(e)}};return s("users/me",t)}(e).then((function(e){i(Object(o.a)(Object(o.a)({},r),{},{loggedIn:!0,email:e.data.email})),t("/")}))};return{authInfo:r,setAuthInfo:i,handleSignup:function(e){return function(e){var t={method:"POST",body:JSON.stringify(e)};return s("signup",t)}(e).then((function(e){}))},handleSignin:function(e){return function(e){var t={method:"POST",body:JSON.stringify(e)};return s("signin",t)}(e).then((function(e){e.token&&(localStorage.setItem("token",e.token),b(e.token))}))},checkToken:function(){var e=localStorage.getItem("token");e&&b(e)},handleLogout:function(){localStorage.removeItem("token"),i(e)}}}var V=function(){var e=Object(a.useState)(!1),t=Object(l.a)(e,2),n=t[0],c=t[1],r=Object(a.useState)(!1),i=Object(l.a)(r,2),b=i[0],f=i[1],O=Object(a.useState)(!1),g=Object(l.a)(O,2),k=g[0],N=g[1],y=Object(a.useState)(!1),S=Object(l.a)(y,2),P=S[0],w=S[1],V=Object(a.useState)(!1),F=Object(l.a)(V,2),Q=F[0],q=F[1],J=Object(a.useState)({}),B=Object(l.a)(J,2),W=B[0],R=B[1],z=Object(a.useState)({}),H=Object(l.a)(z,2),M=H[0],G=H[1],K=D(),X=K.authInfo,Y=K.handleSignup,Z=K.handleSignin,$=K.checkToken,ee=K.handleLogout;function te(){c(!1),f(!1),N(!1),w(!1),q(!1)}Object(a.useEffect)((function(){$(),C.getUserInfo().then((function(e){G(e)})).catch(v)}),[]);var ne=Object(a.useState)([]),ae=Object(l.a)(ne,2),ce=ae[0],re=ae[1];return Object(a.useEffect)((function(){C.getInitialCards().then((function(e){re(e)})).catch(v)}),[]),Object(j.jsx)("div",{className:"wrapper",children:Object(j.jsxs)(m.Provider,{value:M,children:[Object(j.jsx)(d,Object(o.a)({handleLogout:ee},X)),Object(j.jsxs)(u.d,{children:[Object(j.jsx)(u.b,{path:"/sign-up",element:Object(j.jsx)(U,{handleSubmit:Y})}),Object(j.jsx)(u.b,{path:"/sign-in",element:Object(j.jsx)(A,{handleSubmit:Z})}),Object(j.jsx)(u.b,{path:"/",element:Object(j.jsxs)(I,Object(o.a)(Object(o.a)({},X),{},{redirectTo:"/sign-in",children:[Object(j.jsx)(_,{onEditAvatar:function(){c(!0)},onEditProfile:function(){N(!0)},onAddPlace:function(){f(!0)},cards:ce,onCardClick:function(e){R(e),w(!0)},onCardLike:function(e,t){C.setStateLike(e._id,t).then((function(t){re((function(n){return n.map((function(n){return n._id===e._id?t:n}))}))})).catch(v)},onCardDelete:function(e){R(e),q(!0)}}),Object(j.jsx)(p,{}),Object(j.jsx)(T,{isOpen:k,onClose:te,onUpdateUser:function(e){return C.patchUserInfo(e).then((function(e){G(e)})).catch(v)},setOpenState:N}),Object(j.jsx)(E,{isOpen:b,onClose:te,onAddCard:function(e){return C.postCard(e).then((function(e){re([e].concat(Object(s.a)(ce)))})).catch(v)},setOpenState:f}),Object(j.jsx)(L,{isOpen:n,onClose:te,onUpdateAvatar:function(e){return C.patchAvatar(e).then((function(e){G(e)})).catch(v)},setOpenState:c}),Object(j.jsx)(h,{isOpen:Q,onClose:te,onSubmit:function(){return C.deleteCard(W._id).then((function(){re((function(e){return e.filter((function(e){return e._id!==W._id}))}))})).catch(v)},title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",name:"accept",buttonText:"\u0414\u0430",buttonWaitingText:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435...",setOpenState:q}),Object(j.jsx)(x,{card:W,isOpen:P,onClose:te,setOpenState:w})]}))})]})]})})},F=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,22)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),r(e),i(e)}))};i.a.render(Object(j.jsx)(c.a.StrictMode,{children:Object(j.jsx)(b.a,{children:Object(j.jsx)(V,{})})}),document.getElementById("root")),F()}},[[21,1,2]]]);
//# sourceMappingURL=main.89fd7555.chunk.js.map